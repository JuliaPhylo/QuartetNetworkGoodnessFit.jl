<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>goodness of fit · QGoF</title><meta name="title" content="goodness of fit · QGoF"/><meta property="og:title" content="goodness of fit · QGoF"/><meta property="twitter:title" content="goodness of fit · QGoF"/><meta name="description" content="Documentation for QGoF."/><meta property="og:description" content="Documentation for QGoF."/><meta property="twitter:description" content="Documentation for QGoF."/><meta property="og:url" content="https://cecileane.github.io/QuartetNetworkGoodnessFit.jl/stable/man/gof/"/><meta property="twitter:url" content="https://cecileane.github.io/QuartetNetworkGoodnessFit.jl/stable/man/gof/"/><link rel="canonical" href="https://cecileane.github.io/QuartetNetworkGoodnessFit.jl/stable/man/gof/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="QGoF logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">QGoF</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">home</a></li><li><span class="tocitem">manual</span><ul><li class="is-active"><a class="tocitem" href>goodness of fit</a><ul class="internal"><li><a class="tocitem" href="#testing-candidate-networks"><span>testing candidate networks</span></a></li><li><a class="tocitem" href="#parallel-computations"><span>parallel computations</span></a></li><li><a class="tocitem" href="#empirical-p-value"><span>empirical p-value</span></a></li></ul></li><li><a class="tocitem" href="../simulate/">simulating quartet concordance factors</a></li><li><a class="tocitem" href="../expected_qCFs/">expected concordance factors</a></li></ul></li><li><span class="tocitem">library</span><ul><li><a class="tocitem" href="../../lib/public/">public</a></li><li><a class="tocitem" href="../../lib/internal/">internal</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">manual</a></li><li class="is-active"><a href>goodness of fit</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>goodness of fit</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/cecileane/QuartetNetworkGoodnessFit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/cecileane/QuartetNetworkGoodnessFit.jl/blob/master/docs/src/man/gof.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="goodness_of_fit_1"><a class="docs-heading-anchor" href="#goodness_of_fit_1">goodness of fit of a candidate network</a><a id="goodness_of_fit_1-1"></a><a class="docs-heading-anchor-permalink" href="#goodness_of_fit_1" title="Permalink"></a></h1><p>The example data set in this package is very small (5 taxa) on purpose: to make this tutorial run quickly. The data list all four-taxon sets, and the concordance factor (CF) for each of the 3 topologies on these 4 taxa, that is, the proportion of genes estimated to have each 4-taxon unrooted topology.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using QuartetNetworkGoodnessFit, DataFrames, CSV</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; qCF = DataFrame(CSV.File(joinpath(dirname(pathof(QuartetNetworkGoodnessFit)), &quot;..&quot;,&quot;test&quot;,&quot;example_qCF_5taxa.csv&quot;)), copycols=false);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; qCF</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr1">15×8 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> t1       t2       t3       t4       CF12_34  CF13_24  CF14_23  ngenes </span>
     │<span class="sgr90"> String1  String1  String1  String1  Float64  Float64  Float64  Int64  </span>
─────┼───────────────────────────────────────────────────────────────────────
   1 │ A        B        C        D          0.99     0.005    0.005     200
   2 │ A        B        C        E          0.825    0.095    0.08      200
   3 │ A        B        D        E          0.825    0.095    0.08      200
   4 │ A        C        D        E          0.005    0.025    0.97      200
   5 │ B        C        D        E          0.005    0.025    0.97      200
   6 │ A        B        C        O          0.83     0.09     0.08      200
   7 │ A        B        D        O          0.83     0.09     0.08      200
   8 │ A        C        D        O          0.005    0.025    0.97      200
   9 │ B        C        D        O          0.005    0.025    0.97      200
  10 │ A        B        E        O          0.84     0.08     0.08      200
  11 │ A        C        E        O          0.685    0.265    0.05      200
  12 │ B        C        E        O          0.68     0.265    0.055     200
  13 │ A        D        E        O          0.685    0.265    0.05      200
  14 │ B        D        E        O          0.68     0.265    0.055     200
  15 │ C        D        E        O          1.0      0.0      0.0       200</code></pre><h2 id="testing-candidate-networks"><a class="docs-heading-anchor" href="#testing-candidate-networks">testing candidate networks</a><a id="testing-candidate-networks-1"></a><a class="docs-heading-anchor-permalink" href="#testing-candidate-networks" title="Permalink"></a></h2><p>Let&#39;s say we have two candidate networks to test: one that is just a tree (net0), and the other that has one reticulation (net1).</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using PhyloNetworks</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; net1 = readTopology(&quot;((((D,C),((A,B))#H1),(#H1,E)),O);&quot;);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; net0 = readTopology(&quot;((((D,C),(A,B)),E),O);&quot;); # also: majorTree(net1)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p><code>net0</code> has clades AB and CD sister to each other, with E sister to ABCD and an outgroup O. <code>net1</code> has <code>net0</code> as its major tree, and has a reticulation going from E into the stem lineage to AB.</p><p>The goal is to test the goodness-of-fit of each topology.</p><p>It&#39;s best to start with a small number of simulations for the test, to check that there are no issue. Then we can re-run with a larger number. Note that the first use of a function includes time to compile the function, so it takes longer than the second use. Below, the option <code>true</code> means that we want to optimize the branch lengths in the network, in coalescent units, before quantifying the goodness-of-fit.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res0 = quarnetGoFtest!(net0, qCF, true; seed=201, nsim=3);</code><code class="nohighlight hljs ansi" style="display:block;">200.0 gene trees per 4-taxon set</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Before re-running with more simulations, we can update the network <code>net0</code> to the version that has optimized branch lengths:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; net0 = res0[5]</code><code class="nohighlight hljs ansi" style="display:block;">HybridNetwork, Rooted Network
9 edges
10 nodes: 6 tips, 0 hybrid nodes, 4 internal tree nodes.
tip labels: D, C, A, B, ...
(((D:0.0,C:0.0):3.197,(A:1.931,B:1.931):1.265):0.71,E:3.907,O:3.907);</code></pre><p>Now we re-run the test using the option <code>false</code> to not re-optimize branch lengths. We use <code>nsim=200</code> simulations below to make this example faster. For a real data analysis, delete the <code>nsim</code> option to use the default instead (1000) or specify a higher value.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res0 = quarnetGoFtest!(net0, qCF, false; seed=234, nsim=200);</code><code class="nohighlight hljs ansi" style="display:block;">200.0 gene trees per 4-taxon set</code></pre><p>In the result, the first 3 numbers are the p-value of the overall goodness-of-fit test, the uncorrected z-value, and the estimate of σ to correct the z-value for dependence:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res0[[1,2,3]] # p-value, uncorrected z, σ</code><code class="nohighlight hljs ansi" style="display:block;">(0.0003644828204847111, 5.034965460952285, 1.4903196407411892)</code></pre><p>Here, we have evidence that the tree <code>net0</code> does not fit the data adequately. Note that σ=1 corresponds to independent quartet outlier p-values. Typical estimates of σ are quite larger than 1, increase with the number of taxa, and increase with longer branch lengths (for a given number of taxa).</p><p>The next element is the list of outlier p-values, which was also added to the data frame that contains our data:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res0[4]</code><code class="nohighlight hljs ansi" style="display:block;">15-element Vector{Float64}:
 0.9382013534363636
 0.784413132415509
 0.784413132415509
 0.2269789649305843
 0.2269789649305843
 0.7569552453692212
 0.7569552453692212
 0.2269789649305843
 0.2269789649305843
 0.01049607485373507
 9.436389213966022e-8
 2.9912016026156043e-7
 9.436389213966022e-8
 2.9912016026156043e-7
 0.06730578641440749</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; qCF[:,[:t1,:t2,:t3,:t4,:p_value]]</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr1">15×5 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> t1       t2       t3       t4       p_value    </span>
     │<span class="sgr90"> String1  String1  String1  String1  Float64    </span>
─────┼────────────────────────────────────────────────
   1 │ A        B        C        D        0.938201
   2 │ A        B        C        E        0.784413
   3 │ A        B        D        E        0.784413
   4 │ A        C        D        E        0.226979
   5 │ B        C        D        E        0.226979
   6 │ A        B        C        O        0.756955
   7 │ A        B        D        O        0.756955
   8 │ A        C        D        O        0.226979
   9 │ B        C        D        O        0.226979
  10 │ A        B        E        O        0.0104961
  11 │ A        C        E        O        9.43639e-8
  12 │ B        C        E        O        2.9912e-7
  13 │ A        D        E        O        9.43639e-8
  14 │ B        D        E        O        2.9912e-7
  15 │ C        D        E        O        0.0673058</code></pre><p>The very small overall p-value indicated an excess of outlier four-taxon sets. Here we see what these outliers are: all four-taxon sets containing O, E and either A or B are strong outliers (very small outlier p-values).</p><p>In fact, the CF data were simulated on <code>net1</code>, in which the AB clade received gene flow from E. We can re-run an analysis using <code>net1</code> this time:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res1 = quarnetGoFtest!(net1, qCF, true; seed=271, nsim=1000);</code><code class="nohighlight hljs ansi" style="display:block;">200.0 gene trees per 4-taxon set
hybrid edges for hybrid node 5 have missing gamma&#39;s, set default: 0.9,0.1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; res1[[1,2,3]] # p-value, uncorrected z, σ</code><code class="nohighlight hljs ansi" style="display:block;">(0.6762814750767907, -0.8885233166386386, 1.9428681998800792)</code></pre><p>This network is found to provide an adequate absolute fit (as expected from how the data were simulated).</p><p>Note that after optimization of branch lengths and γs to best fit the CF data, the network was &quot;ultrametrized&quot; along its major tree to assign values to missing edge lengths. External edges are typically missing a length in coalescent units if there was a single individual sampled per species, for example.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res1[5]</code><code class="nohighlight hljs ansi" style="display:block;">HybridNetwork, Rooted Network
12 edges
12 nodes: 6 tips, 1 hybrid nodes, 5 internal tree nodes.
tip labels: D, C, A, B, ...
(((D:5.685,C:5.685):2.623,((A:0.0,B:0.0):1.035)#H1:7.273::0.63):7.38,(#H1:0.968::0.37,E:14.83):0.858,O:15.688);</code></pre><p>For more options, see <a href="../../lib/public/#QuartetNetworkGoodnessFit.quarnetGoFtest!-Tuple{HybridNetwork, DataFrames.DataFrame, Bool}"><code>quarnetGoFtest!</code></a>, such as for the outlier test statistic (G or likelihood ratio test by default).</p><h2 id="parallel-computations"><a class="docs-heading-anchor" href="#parallel-computations">parallel computations</a><a id="parallel-computations-1"></a><a class="docs-heading-anchor-permalink" href="#parallel-computations" title="Permalink"></a></h2><p>For larger networks, the large number of four-taxon sets causes the test to run more slowly. The computations can be parallelized by providing more processors to Julia. For instance, this can be done by starting julia with the <code>-p</code> option:</p><pre><code class="language-shell hljs">julia -p 3 # 3 worker processors, 4 processors total</code></pre><h2 id="empirical-p-value"><a class="docs-heading-anchor" href="#empirical-p-value">empirical p-value</a><a id="empirical-p-value-1"></a><a class="docs-heading-anchor-permalink" href="#empirical-p-value" title="Permalink"></a></h2><p>&quot;Nice&quot; networks with long branch lengths in coalescent units lead to &quot;nice&quot; expected quartet concordance factors close to [100%, 0%, 0%], when gene trees are expected to agree on a good proportion of 4-taxon sets. On these networks and data sets with few loci, the distribution of the test z-value may be too far from a normal approximation. <a href="../../lib/public/#QuartetNetworkGoodnessFit.quarnetGoFtest!-Tuple{HybridNetwork, DataFrames.DataFrame, Bool}"><code>quarnetGoFtest!</code></a> attempts to detect this issue. If it does, it sends a warning suggesting to use an empirical p-value instead of using the p-value returned by the first element of the output (e.g. <code>res1[1]</code>).</p><p>Here is example code to calculate the p-value from the empirical distribution of simulated z-values. Note that a large number of simulations is needed for this. We used <code>nsim=1000</code> to test network 1 above, which is a good place to start.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; zvalue_observed = res1[2]</code><code class="nohighlight hljs ansi" style="display:block;">-0.8885233166386386</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; zvalue_bootstrap = sort!(res1[6]) # sorted z-values simulated under the network</code><code class="nohighlight hljs ansi" style="display:block;">1000-element SharedArrays.SharedVector{Float64}:
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
 -0.8885233166386386
  ⋮
  7.4043609719886545
  7.4043609719886545
  8.589058727506838
  8.589058727506838
  8.589058727506838
  8.589058727506838
  8.589058727506838
  9.773756483025023
  9.773756483025023</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; length(zvalue_bootstrap) # just to check we ran many simulations</code><code class="nohighlight hljs ansi" style="display:block;">1000</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Statistics # to access &quot;mean&quot;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pvalue = mean(zvalue_bootstrap .&gt;= zvalue_observed) # one-sided test: Prob(Z &gt; z)</code><code class="nohighlight hljs ansi" style="display:block;">1.0</code></pre><p>In this case we get a p-value of 1.0, which is consisten with all individual outlier p-values being large, for <em>all</em> four-taxon sets as seen earlier: the quartet CFs couldn&#39;t fit <code>net1</code> better.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« home</a><a class="docs-footer-nextpage" href="../simulate/">simulating quartet concordance factors »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Monday 20 May 2024 18:49">Monday 20 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
