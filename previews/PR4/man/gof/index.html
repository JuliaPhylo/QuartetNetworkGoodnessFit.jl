<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>goodness of fit · QuartetNetwork GoF.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="QuartetNetwork GoF.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">QuartetNetwork GoF.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">home</a></li><li><span class="tocitem">manual</span><ul><li class="is-active"><a class="tocitem" href>goodness of fit</a><ul class="internal"><li><a class="tocitem" href="#testing-candidate-networks-1"><span>testing candidate networks</span></a></li><li><a class="tocitem" href="#parallel-computations-1"><span>parallel computations</span></a></li><li><a class="tocitem" href="#quartet-concordance-factor-simulation-1"><span>quartet concordance factor simulation</span></a></li></ul></li></ul></li><li><span class="tocitem">library</span><ul><li><a class="tocitem" href="../../lib/public/">public</a></li><li><a class="tocitem" href="../../lib/internal/">internal</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">manual</a></li><li class="is-active"><a href>goodness of fit</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>goodness of fit</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cecileane/QuartetNetworkGoodnessFit.jl/blob/master/docs/src/man/gof.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Goodness-of-fit-of-a-candidate-network-1"><a class="docs-heading-anchor" href="#Goodness-of-fit-of-a-candidate-network-1">Goodness of fit of a candidate network</a><a class="docs-heading-anchor-permalink" href="#Goodness-of-fit-of-a-candidate-network-1" title="Permalink"></a></h1><p>The example data set in this package is very small (5 taxa) on purpose: to make this tutorial run quickly. The data list all four-taxon sets, and the concordance factor (CF) for each of the 3 topologies on these 4 taxa, that is, the proportion of genes estimated to have each 4-taxon unrooted topology.</p><pre><code class="language-julia-repl">julia&gt; using QuartetNetworkGoodnessFit, DataFrames, CSV

julia&gt; qCF = DataFrame!(CSV.File(joinpath(dirname(pathof(QuartetNetworkGoodnessFit)), &quot;..&quot;,&quot;test&quot;,&quot;example_qCF_5taxa.csv&quot;)));

julia&gt; qCF
15×8 DataFrame
│ Row │ t1     │ t2     │ t3     │ t4     │ CF12_34 │ CF13_24 │ CF14_23 │ ngenes │
│     │ String │ String │ String │ String │ Float64 │ Float64 │ Float64 │ Int64  │
├─────┼────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ 1   │ A      │ B      │ C      │ D      │ 0.99    │ 0.005   │ 0.005   │ 200    │
│ 2   │ A      │ B      │ C      │ E      │ 0.825   │ 0.095   │ 0.08    │ 200    │
│ 3   │ A      │ B      │ D      │ E      │ 0.825   │ 0.095   │ 0.08    │ 200    │
│ 4   │ A      │ C      │ D      │ E      │ 0.005   │ 0.025   │ 0.97    │ 200    │
│ 5   │ B      │ C      │ D      │ E      │ 0.005   │ 0.025   │ 0.97    │ 200    │
│ 6   │ A      │ B      │ C      │ O      │ 0.83    │ 0.09    │ 0.08    │ 200    │
│ 7   │ A      │ B      │ D      │ O      │ 0.83    │ 0.09    │ 0.08    │ 200    │
│ 8   │ A      │ C      │ D      │ O      │ 0.005   │ 0.025   │ 0.97    │ 200    │
│ 9   │ B      │ C      │ D      │ O      │ 0.005   │ 0.025   │ 0.97    │ 200    │
│ 10  │ A      │ B      │ E      │ O      │ 0.84    │ 0.08    │ 0.08    │ 200    │
│ 11  │ A      │ C      │ E      │ O      │ 0.685   │ 0.265   │ 0.05    │ 200    │
│ 12  │ B      │ C      │ E      │ O      │ 0.68    │ 0.265   │ 0.055   │ 200    │
│ 13  │ A      │ D      │ E      │ O      │ 0.685   │ 0.265   │ 0.05    │ 200    │
│ 14  │ B      │ D      │ E      │ O      │ 0.68    │ 0.265   │ 0.055   │ 200    │
│ 15  │ C      │ D      │ E      │ O      │ 1.0     │ 0.0     │ 0.0     │ 200    │</code></pre><h2 id="testing-candidate-networks-1"><a class="docs-heading-anchor" href="#testing-candidate-networks-1">testing candidate networks</a><a class="docs-heading-anchor-permalink" href="#testing-candidate-networks-1" title="Permalink"></a></h2><p>Let&#39;s say we have two candidate networks to test: one that is just a tree (net0), and the other that has one reticulation (net1).</p><pre><code class="language-julia-repl">julia&gt; using PhyloNetworks

julia&gt; net1 = readTopology(&quot;((((D,C),((A,B))#H1),(#H1,E)),O);&quot;);

julia&gt; net0 = readTopology(&quot;((((D,C),(A,B)),E),O);&quot;); # also: majorTree(net1)</code></pre><p><code>net0</code> has clades AB and CD sister to each other, with E sister to ABCD and an outgroup O. <code>net1</code> has <code>net0</code> as its major tree, and has a reticulation going from E into the stem lineage to AB.</p><p>The goal is to test the goodness-of-fit of each topology.</p><p>It&#39;s best to start with a small number of simulations for the test, to check that there are no issue. Then we can re-run with a larger number. Note that the first use of a function includes time to compile the function, so it takes longer than the second use. Below, the option <code>true</code> means that we want to optimize the branch lengths in the network, in coalescent units, before quantifying the goodness-of-fit.</p><pre><code class="language-julia-repl">julia&gt; res0 = quarnetGoFtest!(net0, qCF, true; seed=234, nsim=2);
200.0 gene trees per 4-taxon set</code></pre><p>Before re-running with more simulations, we can update the network <code>net0</code> to the version that has optimized branch lengths:</p><pre><code class="language-julia-repl">julia&gt; net0 = res0[5]
HybridNetwork, Rooted Network
9 edges
10 nodes: 6 tips, 0 hybrid nodes, 4 internal tree nodes.
tip labels: D, C, A, B, ...
(((D:0.0,C:0.0):3.201,(A:1.933,B:1.933):1.268):0.711,E:3.912,O:3.912);</code></pre><p>Now we re-run the test using the option <code>false</code> to not re-optimize branch lengths. We use <code>nsim=200</code> simulations below to make this example faster. For a real data analysis, delete the <code>nsim</code> option to use the default instead (1000) or specify higher value.</p><pre><code class="language-julia-repl">julia&gt; res0 = quarnetGoFtest!(net0, qCF, false; seed=234, nsim=200);
200.0 gene trees per 4-taxon set</code></pre><p>In the result, the first 3 numbers are the p-value of the overall goodness-of-fit test, the uncorrected z-value, and the estimate of σ to correct the z-value for dependence:</p><pre><code class="language-julia-repl">julia&gt; res0[[1,2,3]] # p-value, uncorrected z, σ
(0.0010376989827210526, 5.034965460952285, 1.635140425323255)</code></pre><p>Here, we have evidence that the tree <code>net0</code> does not fit the data adequately. Note that σ=1 corresponds to independent quartet outlier p-values. Typical estimates of σ are quite larger than 1, increase with the number of taxa, and increase with longer branch lengths (for a given number of taxa).</p><p>The next element is the list of outlier p-values, which was also added to the data frame that contains our data:</p><pre><code class="language-julia-repl">julia&gt; res0[4]
15-element Array{Float64,1}:
 0.93548482433139
 0.7903913213966525
 0.7903913213966525
 0.22648889585910295
 0.22648889585910295
 0.7649801373330675
 0.7649801373330675
 0.22648889585910295
 0.22648889585910295
 0.009946859148794496
 9.478813417519991e-8
 2.9992751677925755e-7
 9.478813417519991e-8
 2.9992751677925755e-7
 0.06821910216330293

julia&gt; qCF[:,[:t1,:t2,:t3,:t4,:p_value]]
15×5 DataFrame
│ Row │ t1     │ t2     │ t3     │ t4     │ p_value    │
│     │ String │ String │ String │ String │ Float64    │
├─────┼────────┼────────┼────────┼────────┼────────────┤
│ 1   │ A      │ B      │ C      │ D      │ 0.935485   │
│ 2   │ A      │ B      │ C      │ E      │ 0.790391   │
│ 3   │ A      │ B      │ D      │ E      │ 0.790391   │
│ 4   │ A      │ C      │ D      │ E      │ 0.226489   │
│ 5   │ B      │ C      │ D      │ E      │ 0.226489   │
│ 6   │ A      │ B      │ C      │ O      │ 0.76498    │
│ 7   │ A      │ B      │ D      │ O      │ 0.76498    │
│ 8   │ A      │ C      │ D      │ O      │ 0.226489   │
│ 9   │ B      │ C      │ D      │ O      │ 0.226489   │
│ 10  │ A      │ B      │ E      │ O      │ 0.00994686 │
│ 11  │ A      │ C      │ E      │ O      │ 9.47881e-8 │
│ 12  │ B      │ C      │ E      │ O      │ 2.99928e-7 │
│ 13  │ A      │ D      │ E      │ O      │ 9.47881e-8 │
│ 14  │ B      │ D      │ E      │ O      │ 2.99928e-7 │
│ 15  │ C      │ D      │ E      │ O      │ 0.0682191  │</code></pre><p>The very small overall p-value indicated an excess of outlier four-taxon sets. Here we see what these outliers are: all four-taxon sets containing O, E and either A or B are strong outliers (very small outlier p-values).</p><p>In fact, the CF data were simulated on <code>net1</code>, in which the AB clade received gene flow from E. (See below if interested in the simulation). We can re-run an analysis using <code>net1</code> this time:</p><pre><code class="language-julia-repl">julia&gt; res1 = quarnetGoFtest!(net1, qCF, true; seed=721, nsim=200);
200.0 gene trees per 4-taxon set
hybrid edges for hybrid node 5 have missing gamma&#39;s, set default: 0.9,0.1

julia&gt; res1[[1,2,3]]
(0.7028674648341886, -0.8885233166386386, 1.6680695849846545)</code></pre><p>This network is found to provide an adequate absolute fit (as expected from how the data were simulated).</p><p>Note that after optimization of branch lengths and γs to best fit the CF data, the network was &quot;ultrametrized&quot; along its major tree to adhere to the hybrid-lambda simulator&#39;s requirement that the network is ultrametric:</p><pre><code class="language-julia-repl">julia&gt; res1[5]
HybridNetwork, Rooted Network
12 edges
12 nodes: 6 tips, 1 hybrid nodes, 5 internal tree nodes.
tip labels: D, C, A, B, ...
(((D:0.0,C:0.0):2.903,((A:0.622,B:0.622):0.957)#H1:1.324::0.774):1.696,(#H1:0.348::0.226,E:1.537):3.063,O:4.599);</code></pre><p>For more options, see <a href="../../lib/public/#QuartetNetworkGoodnessFit.quarnetGoFtest!-Tuple{HybridNetwork,DataFrames.DataFrame,Bool}"><code>quarnetGoFtest!</code></a>, such as for the outlier test statistic (G or likelihood ratio test by default).</p><h2 id="parallel-computations-1"><a class="docs-heading-anchor" href="#parallel-computations-1">parallel computations</a><a class="docs-heading-anchor-permalink" href="#parallel-computations-1" title="Permalink"></a></h2><p>For larger networks, the large number of four-taxon sets causes the test to run more slowly. The computations can be parallelized by providing more processors to Julia. For instance, this can be done by starting julia with the <code>-p</code> option:</p><pre><code class="language-shell">julia -p 3 # 3 worker processors, 4 processors total</code></pre><p>To check for progress during the test, we can check for a new directory with a name starting with <code>jl_</code>, such as <code>jl_0CVOfE</code> (the end of this name is randomly generated). Then we can check the files in this directory: their names are indicative of the simulation replicate number that is currently being processed. In the example below, there are 3 files in my <code>jl_0CVOfE</code> directory (because of using 3 workers), and these files show processing replicate numbers 106, 440 and 773 (out of the 1000 replicates by default). Each contains 200 lines (because it contains 1 gene tree per line, since the original data had 200 genes). It means that the simulation-based test is at about 1/3 of its way. By the way, these files should not be modified. At the end of the simulation-based test, these temporary files and folder are automatically deleted.</p><pre><code class="language-shell">$ wc -l jl_0CVOfE/*
     200 jl_0CVOfE/genetrees_rep106_coal_unit
     200 jl_0CVOfE/genetrees_rep440_coal_unit
     200 jl_0CVOfE/genetrees_rep773_coal_unit</code></pre><h2 id="quartet-concordance-factor-simulation-1"><a class="docs-heading-anchor" href="#quartet-concordance-factor-simulation-1">quartet concordance factor simulation</a><a class="docs-heading-anchor-permalink" href="#quartet-concordance-factor-simulation-1" title="Permalink"></a></h2><p>The data in <code>qCF</code> were simulated using <a href="https://github.com/hybridLambda/hybrid-Lambda">hybrid-Lambda</a>, which comes with <code>QuartetNetworkGoodnessFit</code>. In the code below, hybrid-lambda is called within julia, asking for the simulation of 200 genes (<code>-num 200</code>).</p><p>Note that hybrid-lambda assumes that the tree or network is ultrametric, but runs even if this assumption is not met.</p><pre><code class="language-julia">net1 = readTopology(&quot;((((D:0.2,C:0.2):2.4,((A:0.4,B:0.4):1.1)#H1:1.1::0.7):2.0,(#H1:0.0::0.3,E:1.5):3.1):1.0,O:5.6);&quot;);
hl = QuartetNetworkGoodnessFit.hybridlambda # path to hybrid-lambda simulator, on local machine
net1HL = hybridlambdaformat(net1) # format for the network, to use below by hybrid-lambda
run(`$hl -spcu &quot;((((D:0.2,C:0.2)I1:2.4,((A:0.4,B:0.4)I2:1.1)H1#0.7:1.1)I3:2.0,(H1#0.7:0.0,E:1.5)I4:3.1)I5:1.0,O:5.6)I6;&quot; -num 200 -seed 123 -o &quot;genetrees&quot;`)
treelist = readMultiTopology(&quot;genetrees_coal_unit&quot;)
obsCF = writeTableCF(countquartetsintrees(treelist)...)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« home</a><a class="docs-footer-nextpage" href="../../lib/public/">public »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 14 July 2020 18:36">Tuesday 14 July 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
